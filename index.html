<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тренажер Ритму для Барабанів | Rankova Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .main-container {
            position: relative; /* Needed for sticker positioning */
            overflow: hidden; /* Keeps sticker within bounds */
        }
        .drum-part {
            cursor: pointer;
            transition: transform 0.1s ease-in-out;
            transform-origin: center center;
        }
        .drum-part .drum-shape {
             transition: fill 0.1s ease-in-out;
        }
        .drum-part .drum-label {
            fill: white;
            font-weight: 700;
            font-size: 14px;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .drum-part.playing {
            transform: scale(1.05);
        }
        .drum-part.playing .drum-shape {
            filter: brightness(1.2);
        }

        .pro-button {
            transition: all 0.2s ease-in-out;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            background-color: #ffd200;
            color: #1e293b;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .pro-button:hover:not(:disabled) {
            background-color: #e6be00;
        }
        .pro-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .beat-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .difficulty-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            color: #475569;
            background-color: #f1f5f9;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .difficulty-btn.active {
            background-color: #ffd200;
            color: #1e293b;
            border-color: #ffd200;
        }
        .difficulty-btn:not(.active):hover {
            background-color: #e2e8f0;
        }

        /* Sticker styles -- NEW ANIMATION */
        #sticker-container {
            position: absolute;
            top: 63%;
            right: 10px; /* Final horizontal position */
            width: 200px;
            height: auto;
            z-index: 1000;
            pointer-events: none;
            opacity: 0; /* Start invisible */
            transform: translate(calc(100% + 20px), -50%); /* Start off-screen and vertically centered */
            transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
        }
        #sticker-container.visible {
            opacity: 1; /* Fade in */
            transform: translate(0, -50%); /* Slide to final position */
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="container mx-auto text-center max-w-md">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 main-container">
            <img src="https://github.com/max-vorozhko/rankova_studio_drum/blob/main/Rankova%20logo.png?raw=true" alt="Логотип" class="mx-auto mb-4 h-20">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">Тренажер Ритму</h1>
            <p class="text-slate-500 mb-6">Слухай, запам'ятовуй та повторюй ритм!</p>
            
            <div class="flex items-center justify-between bg-slate-100 rounded-lg p-3 mb-4">
                <div class="text-left">
                    <p class="text-sm font-medium text-slate-500">РАХУНОК</p>
                    <p id="score" class="text-3xl font-bold" style="color: #ffd200;">0</p>
                </div>
                <div class="flex items-center gap-x-2">
                    <button id="restartBtn" class="pro-button">Рестарт</button>
                    <button id="startBtn" class="pro-button">Почати</button>
                </div>
            </div>

             <div class="flex justify-center gap-x-2 mb-4">
                <button class="difficulty-btn active" data-difficulty="easy">Легко</button>
                <button class="difficulty-btn" data-difficulty="medium">Середнє</button>
                <button class="difficulty-btn" data-difficulty="hard">Складно</button>
            </div>
            
            <div class="bg-slate-50 rounded-lg p-3 mb-4 text-center">
                 <div class="flex justify-center items-center gap-x-3 h-8" id="beat-pattern-container">
                 </div>
                 <button id="toggle-visual" class="text-xs text-slate-400 hover:text-slate-600 mt-2">Сховати візуалізацію</button>
            </div>

            <p id="message" class="h-6 mb-4 text-lg font-semibold text-slate-700">Натисни "Почати", щоб грати</p>
            
            <div class="relative w-full h-64 md:h-72 my-4">
                <svg id="drum-kit-svg" class="w-full h-full" viewBox="0 0 300 200" preserveAspectRatio="xMidYMin meet">
                    <!-- Stands (decorative) -->
                    <rect x="58" y="90" width="4" height="100" fill="#a1a1aa" rx="2"/>
                    <rect x="158" y="185" width="80" height="4" fill="#a1a1aa" rx="2"/>

                    <!-- Hi-Hat -->
                    <g id="hi-hat" class="drum-part">
                        <ellipse class="drum-shape" cx="60" cy="90" rx="50" ry="15" fill="#facc15"/>
                        <text class="drum-label" x="60" y="94">Hi-Hat</text>
                    </g>
                    <!-- Tom -->
                    <g id="tom" class="drum-part">
                        <path class="drum-shape" d="M 120,70 C 120,86 140,91 160,91 C 180,91 200,86 200,70 L 180,65 C 180,75 170,80 160,80 C 150,80 140,75 140,65 Z" fill="#16a34a"/>
                        <ellipse class="drum-shape" cx="160" cy="70" rx="40" ry="15" fill="#e0f2f1"/>
                        <text class="drum-label" x="160" y="74" fill="#1e293b">Tom</text>
                    </g>
                     <!-- Kick -->
                    <g id="kick" class="drum-part">
                       <circle class="drum-shape" cx="200" cy="135" r="55" fill="#dc2626"/>
                       <text class="drum-label" x="200" y="139">Kick</text>
                    </g>
                    <!-- Snare -->
                    <g id="snare" class="drum-part">
                        <path class="drum-shape" d="M 80,130 C 80,151 105,161 130,161 C 155,161 180,151 180,130 L 160,125 C 160,141 145,145 130,145 C 115,145 100,141 100,125 Z" fill="#4f46e5"/>
                        <ellipse class="drum-shape" cx="130" cy="130" rx="50" ry="20" fill="#e0e7ff"/>
                        <text class="drum-label" x="130" y="134" fill="#1e293b">Snare</text>
                    </g>
                </svg>
            </div>

            <div class="mt-8">
                <a href="https://n813529.alteg.io" target="_blank" class="pro-button inline-block text-lg">Хочу прийти в Rankova Studio на урок</a>
            </div>
            
            <!-- Sticker Container is now inside the main container -->
            <div id="sticker-container"></div>
        </div>
    </div>
    
    <script>
        let audioCtx;
        const audioBuffers = {};
        let soundsLoaded = false;
        let stickerVisible = false;

        const DRUM_COLORS = { // Only used for beat indicators now
            'kick': { color: 'bg-red-500' },
            'snare': { color: 'bg-blue-500' },
            'hi-hat': { color: 'bg-yellow-400' },
            'tom': { color: 'bg-green-500' }
        };
        
        function loadSound(name, url) {
            return new Promise((resolve, reject) => {
                if (!audioCtx) return reject('AudioContext not initialized');
                fetch(url)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return response.arrayBuffer();
                    })
                    .then(arrayBuffer => audioCtx.decodeAudioData(arrayBuffer, buffer => {
                        audioBuffers[name] = buffer;
                        resolve();
                    }))
                    .catch(e => reject(`Failed to load sound ${name}: ${e}`));
            });
        }

        async function initAudio() {
            if (soundsLoaded) return;
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                } catch(e) {
                    console.error('Web Audio API is not supported in this browser');
                    return Promise.reject(e);
                }
            }
            if (audioCtx.state === 'suspended') {
                await audioCtx.resume();
            }
            const soundUrls = {
                'kick': 'https://raw.githubusercontent.com/wesbos/JavaScript30/master/01%20-%20JavaScript%20Drum%20Kit/sounds/kick.wav',
                'snare': 'https://raw.githubusercontent.com/wesbos/JavaScript30/master/01%20-%20JavaScript%20Drum%20Kit/sounds/snare.wav',
                'hi-hat': 'https://raw.githubusercontent.com/wesbos/JavaScript30/master/01%20-%20JavaScript%20Drum%20Kit/sounds/hihat.wav',
                'tom': 'https://raw.githubusercontent.com/wesbos/JavaScript30/master/01%20-%20JavaScript%20Drum%20Kit/sounds/tom.wav'
            };
            const loadPromises = Object.keys(soundUrls).map(key => loadSound(key, soundUrls[key]));
            await Promise.all(loadPromises);
            soundsLoaded = true;
        }

        function playSound(name) {
            if (!audioCtx || !audioBuffers[name]) { return; }
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            const source = audioCtx.createBufferSource();
            source.buffer = audioBuffers[name];
            source.connect(audioCtx.destination);
            source.start(0);
        }

        const drums = {
            'kick': { el: document.getElementById('kick')},
            'snare': { el: document.getElementById('snare')},
            'hi-hat': { el: document.getElementById('hi-hat')},
            'tom': { el: document.getElementById('tom')}
        };

        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreEl = document.getElementById('score');
        const messageEl = document.getElementById('message');
        const beatPatternContainer = document.getElementById('beat-pattern-container');
        const toggleVisualBtn = document.getElementById('toggle-visual');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const stickerContainer = document.getElementById('sticker-container');

        let sequence = [];
        let playerSequence = [];
        let score = 0;
        let gameActive = false;
        let visualHidden = false;
        let currentDifficulty = 'easy';
        const BEAT_SPEEDS = { easy: 600, medium: 450, hard: 300 };

        const STICKER_SCORE_THRESHOLD = 10; // Score to show sticker (for testing)

        function showSticker() {
            if (!stickerVisible) {
                stickerContainer.innerHTML = `
                    <img src="https://github.com/max-vorozhko/rankova_studio_drum/blob/main/IMG_0817-removebg-preview_wipe_bg.png?raw=true" alt="Awesome!" class="w-full h-auto">
                `;
                stickerContainer.classList.add('visible');
                stickerVisible = true;
                setTimeout(() => {
                    stickerContainer.classList.remove('visible');
                    setTimeout(() => { stickerVisible = false; }, 500); // Wait for animation to finish before resetting flag
                }, 2500); // Sticker visible for 2.5 seconds before starting to hide (total 3s animation)
            }
        }

        function generateSequence() {
            const drumKeys = Object.keys(drums);
            const randomDrum = drumKeys[Math.floor(Math.random() * drumKeys.length)];
            sequence.push(randomDrum);
        }

        function playSequence() {
            gameActive = false;
            messageEl.textContent = 'Слухай та запам\'ятовуй!';
            let i = 0;
            const interval = setInterval(() => {
                if (i < sequence.length) {
                    const drumName = sequence[i];
                    animateDrum(drumName);
                    playSound(drumName);
                    i++;
                } else {
                    clearInterval(interval);
                    gameActive = true;
                    playerSequence = [];
                    messageEl.textContent = 'Твоя черга!';
                }
            }, BEAT_SPEEDS[currentDifficulty]);
        }
        
        function displayBeatPattern() {
            beatPatternContainer.innerHTML = '';
            if (visualHidden) return;
            sequence.forEach(drumName => {
                const indicator = document.createElement('div');
                indicator.className = `beat-indicator ${DRUM_COLORS[drumName].color}`;
                beatPatternContainer.appendChild(indicator);
            });
        }

        function animateDrum(name) {
            const drumEl = drums[name].el;
            drumEl.classList.add('playing');
            setTimeout(() => { drumEl.classList.remove('playing'); }, 200);
        }
        
        function handleDrumClick(name) {
            if (!gameActive) return;
            animateDrum(name);
            playSound(name);
            playerSequence.push(name);
            
            const lastPlayerMoveIndex = playerSequence.length - 1;
            if (playerSequence[lastPlayerMoveIndex] !== sequence[lastPlayerMoveIndex]) {
                messageEl.textContent = 'Помилка! Спробуй цей ритм ще раз.';
                gameActive = false;
                setTimeout(() => { playSequence(); }, 1500);
                return;
            }

            if (playerSequence.length === sequence.length) {
                score++;
                scoreEl.textContent = score;
                if (score === STICKER_SCORE_THRESHOLD) {
                    showSticker();
                }
                messageEl.textContent = '🎉 Чудово! Наступний раунд...';
                gameActive = false;
                setTimeout(() => {
                    generateSequence();
                    displayBeatPattern();
                    playSequence();
                }, 1000);
            }
        }

        async function startGame() {
            startBtn.disabled = true;
            startBtn.textContent = 'Завантаження...';
            try {
                await initAudio();
            } catch (error) {
                console.error("Failed to load audio:", error);
                messageEl.textContent = 'Не вдалося завантажити звук.';
                startBtn.disabled = false;
                startBtn.textContent = 'Почати';
                return;
            }
            
            score = 0;
            scoreEl.textContent = 0;
            sequence = [];
            playerSequence = [];
            startBtn.textContent = 'Гра триває...';
            restartBtn.disabled = false;
            generateSequence();
            displayBeatPattern();
            playSequence();
        }
        
        function resetGame() {
            startBtn.disabled = false;
            startBtn.textContent = 'Почати';
            restartBtn.disabled = true;
            gameActive = false;
            score = 0;
            scoreEl.textContent = 0;
            sequence = [];
            messageEl.textContent = 'Натисни "Почати", щоб грати';
            beatPatternContainer.innerHTML = '';
            stickerContainer.classList.remove('visible'); // Hide sticker on restart
            stickerVisible = false;
        }

        Object.keys(drums).forEach(key => {
            drums[key].el.addEventListener('click', () => handleDrumClick(key));
        });

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', resetGame);
        
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                difficultyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.difficulty;
                if(startBtn.disabled) resetGame();
            });
        });
        
        toggleVisualBtn.addEventListener('click', () => {
            visualHidden = !visualHidden;
            if (visualHidden) {
                beatPatternContainer.style.visibility = 'hidden';
                toggleVisualBtn.textContent = 'Показати візуалізацію';
            } else {
                beatPatternContainer.style.visibility = 'visible';
                toggleVisualBtn.textContent = 'Сховати візуалізацію';
                displayBeatPattern();
            }
        });

    </script>
</body>
</html>



